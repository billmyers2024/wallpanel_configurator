<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Widget Configurator v{{ version }}</title>
    <link rel="stylesheet" href="./static/css/style.css?v=4">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Material Design Icons Inline SVG Styles -->
    <style>
        .mdi-icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            vertical-align: middle;
            fill: currentColor;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-th-large"></i>
                    <h1>Panel Widget Configurator <span style="font-size:14px;color:var(--text-muted)">v{{ version }}</span></h1>
                </div>
                <div class="actions">
                    <button class="btn btn-secondary" onclick="app.loadConfig()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                    <button class="btn btn-secondary" onclick="app.showLoadModal()">
                        <i class="fas fa-folder-open"></i> Load
                    </button>
                    <button class="btn btn-success" onclick="app.saveConfig()">
                        <i class="fas fa-save"></i> Save
                    </button>
                    <button class="btn btn-primary" onclick="app.showExportModal()">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-container">
            <!-- Sidebar - Device List -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <h2>Rooms / Devices</h2>
                    <button class="btn btn-sm btn-primary" onclick="app.addDevice()">
                        <i class="fas fa-plus"></i> Add
                    </button>
                </div>
                <div id="device-list" class="device-list">
                    <!-- Devices populated by JS -->
                </div>
                
                <div class="sidebar-section">
                    <h3>Available Widgets</h3>
                    <div id="widget-types" class="widget-types">
                        <!-- Widget types populated by JS -->
                    </div>
                </div>
            </aside>

            <!-- Main Editor -->
            <main class="editor">
                <div id="no-selection" class="no-selection">
                    <i class="fas fa-arrow-left"></i>
                    <p>Select a device or add a new one to start configuring</p>
                </div>

                <div id="device-editor" class="device-editor" style="display: none;">
                    <!-- Site Settings (Global) -->
                    <div class="site-settings-panel">
                        <div class="section-header" onclick="app.toggleSection('site-settings')">
                            <div class="section-title">
                                <i class="fas fa-cog"></i>
                                <h3>Site Settings</h3>
                                <i class="fas fa-chevron-down toggle-icon" id="site-settings-icon"></i>
                            </div>
                        </div>
                        <div id="site-settings-content" class="section-content" style="display: none;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Site Name</label>
                                    <input type="text" id="site-name" class="input" placeholder="My Home">
                                </div>
                                <div class="form-group">
                                    <label>Version (auto-generated)</label>
                                    <input type="text" id="site-version" class="input" placeholder="1.0" readonly title="Version auto-increments on save">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Guest WiFi SSID</label>
                                    <input type="text" id="guest-ssid" class="input" placeholder="guest_network">
                                </div>
                                <div class="form-group">
                                    <label>Guest WiFi Password</label>
                                    <div class="input-with-action">
                                        <input type="password" id="guest-password" class="input" placeholder="password">
                                        <button class="btn btn-sm btn-secondary" onclick="app.togglePassword('guest-password')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <h4 style="margin-top: 20px; margin-bottom: 12px; color: var(--text-muted); font-size: 14px;">Site Default Cover Timing</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Default Up Time (ms)</label>
                                    <input type="number" id="site-cover-up-time" class="input" value="14300" min="1000" max="60000" step="100">
                                </div>
                                <div class="form-group">
                                    <label>Default Down Time (ms)</label>
                                    <input type="number" id="site-cover-down-time" class="input" value="11500" min="1000" max="60000" step="100">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Default Cover Opening Time</label>
                                    <input type="time" id="cover-opening-time" class="input" value="08:00">
                                </div>
                                <div class="form-group">
                                    <label>Default Cover Closing Time</label>
                                    <input type="time" id="cover-closing-time" class="input" value="19:00">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Spacer between Site Settings and Room -->
                    <div class="site-settings-spacer"></div>

                    <!-- Room Name Header -->
                    <div class="room-name-header">
                        <input type="text" id="device-name" class="input-lg room-name-input" placeholder="Room Name (e.g., Master Bedroom)">
                        <button class="btn btn-danger btn-sm" onclick="app.deleteCurrentDevice()">
                            <i class="fas fa-trash"></i> Delete Room
                        </button>
                    </div>

                    <!-- Room Settings Card - Styled like Site Settings -->
                    <div class="room-settings-card">
                        <div class="section-header" onclick="app.toggleRoomSettings()">
                            <div class="section-title">
                                <i class="fas fa-cog"></i>
                                <h3>Room Settings</h3>
                                <i id="room-settings-toggle" class="fas fa-chevron-down toggle-icon"></i>
                            </div>
                        </div>
                        <div id="room-settings-panel" class="room-settings-panel" style="display: none;">
                            <div class="room-settings-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Device ID</label>
                                    <input type="text" id="device-id" class="input" placeholder="device_id">
                                </div>
                                <div class="form-group">
                                    <label>IP Address</label>
                                    <input type="text" id="device-ip" class="input" placeholder="10.0.0.1">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Presence Sensor Entity</label>
                                    <div class="input-with-action">
                                        <input type="text" id="presence-entity" class="input" placeholder="binary_sensor.room_presence">
                                        <button class="btn btn-sm btn-secondary" onclick="app.showEntityPicker('presence-entity', 'binary_sensor')">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Door Sensor Entity</label>
                                    <div class="input-with-action">
                                        <input type="text" id="door-entity" class="input" placeholder="binary_sensor.room_door">
                                        <button class="btn btn-sm btn-secondary" onclick="app.showEntityPicker('door-entity', 'binary_sensor')">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="voice-assistant-enabled">
                                        <span>Voice Assistant Enabled</span>
                                    </label>
                                </div>
                                <div class="form-group checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="use-presence-for-screen">
                                        <span>Use Presence for Screen</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-row three-col">
                                <div class="form-group">
                                    <label>Screen Timeout (sec)</label>
                                    <input type="number" id="screen-timeout" class="input" value="30" min="5" max="300">
                                </div>
                                <div class="form-group">
                                    <label>Screen Brightness (%)</label>
                                    <input type="number" id="screen-brightness" class="input" value="80" min="10" max="100">
                                </div>
                                <div class="form-group">
                                    <label>Audio Volume (%)</label>
                                    <input type="number" id="volume" class="input" value="50" min="0" max="100">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Widget Sections (Scrollable) -->
                    <div class="widgets-container">
                        <!-- Lights Section -->
                        <section class="widget-section" data-widget="lights">
                            <div class="section-header">
                                <div class="section-title">
                                    <i class="fas fa-lightbulb"></i>
                                    <h3>Lights</h3>
                                    <span class="badge" id="lights-count">0</span>
                                </div>
                                <button class="btn btn-sm btn-primary" onclick="app.addWidget('lights')">
                                    <i class="fas fa-plus"></i> Add Light
                                </button>
                            </div>
                            <div id="lights-list" class="widget-list">
                                <!-- Light widgets -->
                            </div>
                        </section>

                        <!-- Covers Section -->
                        <section class="widget-section" data-widget="covers">
                            <div class="section-header">
                                <div class="section-title">
                                    <!-- MDI Curtains Icon -->
                                    <svg class="mdi-icon" viewBox="0 0 24 24"><path d="M2 3H22V5H20V11C20 14 17.5 16 15 16H13C13 16 13 18 13 20C13 21 12.5 22 12 22C11.5 22 11 21 11 20C11 18 11 16 11 16H9C6.5 16 4 14 4 11V5H2V3M6 5V11C6 12.5 7.5 14 9 14H11V5H6M13 5V14H15C16.5 14 18 12.5 18 11V5H13Z"/></svg>
                                    <h3>Covers</h3>
                                    <span class="badge" id="covers-count">0</span>
                                </div>
                                <button class="btn btn-sm btn-primary" onclick="app.addWidget('covers')">
                                    <i class="fas fa-plus"></i> Add Cover
                                </button>
                            </div>
                            <div id="covers-list" class="widget-list">
                                <!-- Cover widgets -->
                            </div>
                        </section>

                        <!-- Climate Section -->
                        <section class="widget-section" data-widget="climate">
                            <div class="section-header">
                                <div class="section-title">
                                    <i class="fas fa-temperature-half"></i>
                                    <h3>Climate</h3>
                                    <span class="badge" id="climate-count">0</span>
                                </div>
                                <button class="btn btn-sm btn-primary" onclick="app.addWidget('climate')">
                                    <i class="fas fa-plus"></i> Add Climate
                                </button>
                            </div>
                            <div id="climate-list" class="widget-list">
                                <!-- Climate widgets -->
                            </div>
                        </section>

                        <!-- Climate2 Section -->
                        <section class="widget-section" data-widget="climate2">
                            <div class="section-header">
                                <div class="section-title">
                                    <i class="fas fa-temperature-half"></i>
                                    <h3>Climate2 <span style="font-size:11px;font-weight:normal;color:var(--success)">(New)</span></h3>
                                    <span class="badge" id="climate2-count">0</span>
                                </div>
                                <button class="btn btn-sm btn-primary" onclick="app.addWidget('climate2')">
                                    <i class="fas fa-plus"></i> Add Climate2
                                </button>
                            </div>
                            <div class="widget-info" style="padding:8px 12px;background:rgba(76,175,80,0.1);border-left:3px solid var(--success);margin-bottom:12px;font-size:12px;color:var(--text-muted);">
                                <i class="fas fa-info-circle"></i> Simple & Advanced modes with modern UI
                            </div>
                            <div id="climate2-list" class="widget-list">
                                <!-- Climate2 widgets -->
                            </div>
                        </section>

                        <!-- Tester Section (Diagnostic) -->
                        <section class="widget-section" data-widget="tests">
                            <div class="section-header">
                                <div class="section-title">
                                    <!-- MDI Test-tube Icon -->
                                    <svg class="mdi-icon" viewBox="0 0 24 24"><path d="M17 2V4H15V12.5C15 14.43 13.43 16 11.5 16C9.57 16 8 14.43 8 12.5V4H6V2H17M9.5 4V12.5C9.5 13.6 10.4 14.5 11.5 14.5C12.6 14.5 13.5 13.6 13.5 12.5V4H9.5M11.5 18C12.6 18 13.5 18.9 13.5 20H9.5C9.5 18.9 10.4 18 11.5 18M11.5 8C12.6 8 13.5 8.9 13.5 10H9.5C9.5 8.9 10.4 8 11.5 8Z"/></svg>
                                    <h3>Tester <span style="font-size:11px;font-weight:normal;color:var(--text-muted)">(Diagnostic)</span></h3>
                                    <span class="badge" id="tests-count">0</span>
                                </div>
                                <button class="btn btn-sm btn-primary" onclick="app.addWidget('tests')">
                                    <i class="fas fa-plus"></i> Add Test
                                </button>
                            </div>
                            <div class="widget-info" style="padding:8px 12px;background:rgba(59,130,246,0.1);border-left:3px solid var(--info);margin-bottom:12px;font-size:12px;color:var(--text-muted);">
                                <i class="fas fa-info-circle"></i> Use for validation without external hardware dependencies
                            </div>
                            <div id="tests-list" class="widget-list">
                                <!-- Tester widgets -->
                            </div>
                        </section>
                        
                        <section class="widget-section" data-widget="art">
                            <div class="section-header">
                                <div class="section-title">
                                    <!-- MDI Image Icon -->
                                    <svg class="mdi-icon" viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                                    <h3>Art Display</h3>
                                    <span class="badge" id="art-count">0</span>
                                </div>
                                <button class="btn btn-sm btn-primary" onclick="app.addWidget('art')">
                                    <i class="fas fa-plus"></i> Add Art
                                </button>
                            </div>
                            <div class="widget-info" style="padding:8px 12px;background:rgba(168,85,247,0.1);border-left:3px solid var(--secondary);margin-bottom:12px;font-size:12px;color:var(--text-muted);">
                                <i class="fas fa-info-circle"></i> Full-screen image slideshow from /config/www/art/ directory
                            </div>
                            <div id="art-list" class="widget-list">
                                <!-- Art widgets -->
                            </div>
                        </section>
                    </div>
                </div>
            </main>
        </div>

        <!-- Toast Notifications -->
        <div id="toast-container" class="toast-container"></div>

        <!-- Entity Picker Modal -->
        <div id="entity-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Select Entity</h3>
                    <button class="btn-close" onclick="app.closeEntityModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="text" id="entity-search" class="input" placeholder="Search entities...">
                    <div id="entity-list" class="entity-list"></div>
                </div>
            </div>
        </div>

        <!-- Load File Modal -->
        <div id="load-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Load Configuration</h3>
                    <button class="btn-close" onclick="app.closeLoadModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- Staging Files Section -->
                    <div class="load-section">
                        <h4>Staging Files</h4>
                        <div id="staging-files-list" class="staging-files-list">
                            <p class="text-muted">No staging files found</p>
                        </div>
                        <button class="btn btn-secondary btn-sm" onclick="app.refreshStagingFiles()">
                            <i class="fas fa-sync"></i> Refresh List
                        </button>
                    </div>
                    
                    <div class="load-divider">
                        <span>OR</span>
                    </div>
                    
                    <!-- File Upload Section -->
                    <div class="load-section">
                        <h4>Upload from Computer</h4>
                        <input type="file" id="config-file-input" class="input" accept=".json">
                    </div>
                    
                    <div class="modal-actions">
                        <button class="btn btn-secondary" onclick="app.closeLoadModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="app.loadFile()">
                            <i class="fas fa-upload"></i> Load from File
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Modal -->
        <div id="export-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Export Configuration</h3>
                    <button class="btn-close" onclick="app.closeExportModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Filename (without .json)</label>
                        <input type="text" id="export-filename" class="input" value="site_settings">
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-secondary" onclick="app.closeExportModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="app.doExport()">Export</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Save Prompt Modal -->
        <div id="save-prompt-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Make Configuration Live?</h3>
                    <button class="btn-close" onclick="app.closeSavePromptModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you want to make this configuration live?</p>
                    <p style="margin-top: 12px; font-size: 13px; color: var(--text-muted);">
                        <strong>Make Live:</strong> Save and copy to <code>/config/www/panel_widgets/</code> (panels will use this config)<br>
                        <strong>Save Staging:</strong> Save only to <code>/config/panel_widgets/staging/</code> (draft mode)
                    </p>
                    <div class="modal-actions">
                        <button class="btn btn-secondary" onclick="app.closeSavePromptModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="app.doSaveStaging()">Save Staging</button>
                        <button class="btn btn-warning" onclick="app.doSaveLive()">
                            <i class="fas fa-broadcast-tower"></i> Make Live
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Staging Filename Modal -->
        <div id="staging-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Save Staging Configuration</h3>
                    <button class="btn-close" onclick="app.closeStagingModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Filename (without .json)</label>
                        <input type="text" id="staging-filename" class="input" value="site_settings_staging">
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-secondary" onclick="app.closeStagingModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="app.doSaveStagingFile()">Save</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Templates for JavaScript rendering -->
    <template id="light-widget-template">
        <div class="widget-card" data-type="light" data-index="">
            <div class="widget-header">
                <span class="widget-number"></span>
                <div class="widget-validation">
                    <i class="fas fa-check-circle valid" style="display: none;"></i>
                    <i class="fas fa-times-circle invalid" style="display: none;"></i>
                </div>
            </div>
            <div class="widget-body">
                <div class="form-group">
                    <label>Entity ID</label>
                    <div class="input-with-action">
                        <input type="text" class="input entity-input" placeholder="light.entity_name">
                        <button class="btn btn-sm btn-secondary" onclick="app.pickEntity(this, 'light')">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <span class="validation-message"></span>
                </div>
                <div class="form-group">
                    <label>Display Name</label>
                    <input type="text" class="input name-input" placeholder="Light Name">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Type</label>
                        <select class="input type-input">
                            <option value="p">Power Only (p)</option>
                            <option value="ph">Power + Temperature (ph)</option>
                            <option value="phb">Power + Temperature + Brightness (phb)</option>
                            <option value="phc">Power + Temperature + Color (phc)</option>
                            <option value="phbc" selected>Full Control - Power/Temp/Brightness/Color (phbc)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Icon Style</label>
                        <select class="input icon-input">
                            <option value="downlight">Downlight</option>
                            <option value="pendant">Pendant</option>
                            <option value="wardrobe">Wardrobe</option>
                            <option value="lamp">Lamp</option>
                            <option value="spot">Spot</option>
                            <option value="strip">Strip</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="widget-footer">
                <button class="btn btn-sm btn-danger" onclick="app.removeWidget(this)">
                    <i class="fas fa-trash"></i> Remove
                </button>
            </div>
        </div>
    </template>

    <template id="cover-widget-template">
        <div class="widget-card" data-type="cover" data-index="">
            <div class="widget-header">
                <span class="widget-number"></span>
                <div class="widget-validation">
                    <i class="fas fa-check-circle valid" style="display: none;"></i>
                    <i class="fas fa-times-circle invalid" style="display: none;"></i>
                </div>
            </div>
            <div class="widget-body">
                <div class="form-group">
                    <label>Entity ID</label>
                    <div class="input-with-action">
                        <input type="text" class="input entity-input" placeholder="cover.entity_name">
                        <button class="btn btn-sm btn-secondary" onclick="app.pickEntity(this, 'cover')">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <span class="validation-message"></span>
                </div>
                <div class="form-group">
                    <label>Display Name</label>
                    <input type="text" class="input name-input" placeholder="Cover Name">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Type</label>
                        <select class="input type-input">
                            <option value="blind" selected>Vertical Blind</option>
                            <option value="single_curtain">Single Curtain</option>
                            <option value="double_curtain">Double Curtain</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Up Time (ms)</label>
                        <input type="number" class="input uptime-input" value="14300" min="1000" max="60000" step="100">
                    </div>
                    <div class="form-group">
                        <label>Down Time (ms)</label>
                        <input type="number" class="input downtime-input" value="11500" min="1000" max="60000" step="100">
                    </div>
                </div>
            </div>
            <div class="widget-footer">
                <button class="btn btn-sm btn-danger" onclick="app.removeWidget(this)">
                    <i class="fas fa-trash"></i> Remove
                </button>
            </div>
        </div>
    </template>

    <template id="tests-widget-template">
        <div class="widget-card" data-type="tests" data-index="">
            <div class="widget-header">
                <span class="widget-number"></span>
                <div class="widget-validation">
                    <i class="fas fa-check-circle valid" style="display: none;"></i>
                    <i class="fas fa-times-circle invalid" style="display: none;"></i>
                </div>
            </div>
            <div class="widget-body">
                <div class="form-group">
                    <label>Test Slot</label>
                    <select class="input test-id-input">
                        <option value="test_1">Test 1</option>
                        <option value="test_2">Test 2</option>
                        <option value="test_3">Test 3</option>
                        <option value="test_4">Test 4</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Mode</label>
                    <select class="input mode-input" onchange="app.toggleTesterMode(this)">
                        <option value="existing_switch">Use Existing Switch</option>
                        <option value="create_binary_sensor">Create Binary Sensor</option>
                    </select>
                </div>
                <div class="form-group existing-switch-group">
                    <label>Entity ID <span style="font-size:11px;color:var(--text-muted)">(switch, binary_sensor, input_boolean)</span></label>
                    <div class="input-with-action">
                        <input type="text" class="input entity-input" placeholder="switch.test_entity">
                        <button class="btn btn-sm btn-secondary" onclick="app.pickEntity(this, 'switch')">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <span class="validation-message"></span>
                </div>
                <div class="form-group create-sensor-group" style="display:none;">
                    <label>Device Name <span style="font-size:11px;color:var(--text-muted)">(for HA device)</span></label>
                    <input type="text" class="input device-name-input" placeholder="Panel Test">
                    <span class="help-text" style="font-size:11px;color:var(--text-muted);margin-top:4px;display:block;">
                        Creates: binary_sensor.{device_name}_{test_slot}
                    </span>
                </div>
                <div class="form-group">
                    <label>Display Name</label>
                    <input type="text" class="input name-input" placeholder="Test Name">
                </div>
            </div>
            <div class="widget-footer">
                <button class="btn btn-sm btn-danger" onclick="app.removeWidget(this)">
                    <i class="fas fa-trash"></i> Remove
                </button>
            </div>
        </div>
    </template>

    <template id="climate-widget-template">
        <div class="widget-card" data-type="climate" data-index="">
            <div class="widget-header">
                <span class="widget-number"></span>
                <div class="widget-validation">
                    <i class="fas fa-check-circle valid" style="display: none;"></i>
                    <i class="fas fa-times-circle invalid" style="display: none;"></i>
                </div>
            </div>
            <div class="widget-body">
                <div class="form-group">
                    <label>Climate Entity</label>
                    <div class="input-with-action">
                        <input type="text" class="input entity-input" placeholder="climate.entity_name">
                        <button class="btn btn-sm btn-secondary" onclick="app.pickEntity(this, 'climate')">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <span class="validation-message"></span>
                </div>
                <div class="form-group">
                    <label>Display Name</label>
                    <input type="text" class="input name-input" placeholder="Climate Name">
                </div>
                <div class="form-row">
                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" class="presence-deactivate-input">
                            <span>Use Presence for Deactivation</span>
                        </label>
                    </div>
                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" class="presence-activate-input">
                            <span>Use Presence for Activation</span>
                        </label>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Presence Deactivation Time (sec)</label>
                        <input type="number" class="input presence-timeout-input" value="300" min="0" max="3600" step="30">
                    </div>
                    <div class="form-group">
                        <label>Default Fan Speed</label>
                        <select class="input fan-speed-input">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Low Setpoint (째C)</label>
                        <input type="number" class="input low-setpoint-input" value="20" min="10" max="30" step="0.5">
                    </div>
                    <div class="form-group">
                        <label>High Setpoint (째C)</label>
                        <input type="number" class="input high-setpoint-input" value="24" min="15" max="35" step="0.5">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Auto Dehumidify (%)</label>
                        <input type="number" class="input dehumidify-input" value="60" min="30" max="90" step="5">
                    </div>
                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" class="simple-ui-input">
                            <span>Use Simple UI</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="widget-footer">
                <button class="btn btn-sm btn-danger" onclick="app.removeWidget(this)">
                    <i class="fas fa-trash"></i> Remove
                </button>
            </div>
        </div>
    </template>

    <template id="climate2-widget-template">
        <div class="widget-card" data-type="climate2" data-index="">
            <div class="widget-header">
                <span class="widget-number"></span>
                <div class="widget-validation">
                    <i class="fas fa-check-circle valid" style="display: none;"></i>
                    <i class="fas fa-times-circle invalid" style="display: none;"></i>
                </div>
            </div>
            <div class="widget-body">
                <div class="form-group">
                    <label>Climate Entity</label>
                    <div class="input-with-action">
                        <input type="text" class="input entity-input" placeholder="climate.entity_name">
                        <button class="btn btn-sm btn-secondary" onclick="app.pickEntity(this, 'climate')">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <span class="validation-message"></span>
                </div>
                <div class="form-group">
                    <label>Display Name</label>
                    <input type="text" class="input name-input" placeholder="Climate Name">
                </div>
                <div class="form-row">
                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" class="presence-deactivate-input">
                            Use Presence for Deactivation
                        </label>
                    </div>
                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" class="presence-activate-input">
                            Use Presence for Activation
                        </label>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Presence Deactivation Time (sec)</label>
                        <input type="number" class="input presence-timeout-input" value="300" min="0">
                    </div>
                    <div class="form-group">
                        <label>Default Fan Speed</label>
                        <select class="input fan-speed-input">
                            <option value="auto">Auto</option>
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Low Setpoint (째C)</label>
                        <input type="number" class="input low-setpoint-input" value="20" min="10" max="35" step="0.5">
                    </div>
                    <div class="form-group">
                        <label>High Setpoint (째C)</label>
                        <input type="number" class="input high-setpoint-input" value="24" min="10" max="35" step="0.5">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Auto Dehumidify (%)</label>
                        <input type="number" class="input dehumidify-input" value="60" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label>UI Mode</label>
                        <select class="input ui-mode-input">
                            <option value="simple" selected>Simple (Temp, On/Off, Fan)</option>
                            <option value="advanced">Advanced (+ Mode, Presets)</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="widget-footer">
                <button class="btn btn-sm btn-danger" onclick="app.removeWidget(this)">
                    <i class="fas fa-trash"></i> Remove
                </button>
            </div>
        </div>
    </template>

    <template id="art-widget-template">
        <div class="widget-card" data-type="art" data-index="0">
            <div class="widget-header">
                <span class="widget-number">Art Display</span>
                <button class="btn btn-sm btn-primary art-manage-images-btn" onclick="app.openArtImageManager(this)" style="margin-left: auto; margin-right: 10px;">
                    <i class="fas fa-images"></i> Manage Images
                </button>
            </div>
            <div class="widget-body">
                <div class="form-group">
                    <label>Image Directory</label>
                    <input type="text" class="input art-directory" value="/local/art" placeholder="/local/art">
                    <small style="color: var(--text-muted);">Path on HA server (relative to /config/www/)</small>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Transition Time (seconds)</label>
                        <input type="number" class="input art-transition" value="5" min="1" max="3600" step="1">
                    </div>
                    <div class="form-group">
                        <label>Presence Aware</label>
                        <select class="input art-presence">
                            <option value="N" selected>No - Always Show</option>
                            <option value="Y">Yes - Only with Presence</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Presence Sensor</label>
                    <div class="input-with-action">
                        <input type="text" class="input art-presence-sensor" placeholder="binary_sensor.room_presence" disabled>
                        <button class="btn btn-sm btn-secondary" onclick="app.pickEntity(this, 'binary_sensor')" disabled>
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <span class="validation-message"></span>
                </div>
                <div class="form-group">
                    <label>Image Files (one per line)</label>
                    <textarea class="input art-images" rows="5" placeholder="sunset.jpg&#10;mountain.png&#10;abstract.jpg"></textarea>
                    <small style="color: var(--text-muted);">Filenames only - images must be in the directory above</small>
                </div>
            </div>
            <div class="widget-footer">
                <button class="btn btn-sm btn-danger" onclick="app.removeWidget(this)">
                    <i class="fas fa-trash"></i> Remove
                </button>
            </div>
        </div>
    </template>

    <!-- Art Image Manager Modal -->
    <div id="art-image-manager-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px; width: 90%;">
            <div class="modal-header">
                <h3><i class="fas fa-images"></i> Manage Art Images</h3>
                <button class="btn-close" onclick="app.closeArtImageManager()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Image Directory</label>
                    <input type="text" id="art-manager-directory" class="input" value="/local/art" readonly>
                    <small style="color: var(--text-muted);">Images are stored in /config/www/art/</small>
                </div>
                
                <div class="form-group">
                    <label>Upload New Images</label>
                    <div class="file-upload-area" style="border: 2px dashed var(--border-color); border-radius: 8px; padding: 20px; text-align: center; cursor: pointer;" onclick="document.getElementById('art-image-upload').click()">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 24px; color: var(--text-muted);"></i>
                        <p style="margin: 10px 0; color: var(--text-muted);">Click to upload or drag and drop</p>
                        <small style="color: var(--warning);"><strong>Requirements:</strong> 720x720px Baseline JPG only</small><br>
                        <small style="color: var(--text-muted);">Progressive JPEGs and other formats not supported</small>
                    </div>
                    <input type="file" id="art-image-upload" multiple accept=".jpg,.jpeg" style="display: none;" onchange="app.uploadArtImages(this)">
                </div>

                <div class="form-group">
                    <label>Image Order (drag to reorder)</label>
                    <div id="art-image-list" class="art-image-list" style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 4px;">
                        <!-- Images will be rendered here -->
                    </div>
                    <small style="color: var(--text-muted);">Drag images to change order. Click X to delete.</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeArtImageManager()">Cancel</button>
                <button class="btn btn-primary" onclick="app.saveArtImageOrder()">
                    <i class="fas fa-save"></i> Save Order
                </button>
            </div>
        </div>
    </div>

    <script src="./static/js/app.js?v=2"></script>
</body>
</html>
